<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .month-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .month-card:hover {
            transform: translateY(-5px);
        }

        .month-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .weekday-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            background: #f5f5f5;
            border-bottom: 1px solid #ddd;
        }

        .weekday {
            padding: 10px;
            text-align: center;
            font-weight: bold;
            color: #667eea;
            font-size: 0.9em;
        }

        .day-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            padding: 5px;
            gap: 5px;
        }

        .day {
            aspect-ratio: 1;
            padding: 8px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid #e0e0e0;
            transition: all 0.3s ease;
            font-weight: 500;
            position: relative;
        }

        .day:hover {
            border-color: #667eea;
            background: #f0f0ff;
        }

        .day.empty {
            cursor: default;
            background: #fafafa;
        }

        .day.empty:hover {
            border-color: #e0e0e0;
            background: #fafafa;
        }

        .day.selected {
            border-color: #333;
            font-weight: bold;
        }

        .day.sunday {
            background-color: #ffcccc;
            color: #ff0000;
            font-weight: bold;
        }

        .day.sunday.holiday {
            color: white;
        }

        .day.holiday {
            font-weight: bold;
            color: white;
            border: none;
            position: relative;
        }

        .day.holiday::after {
            content: '‚òÖ';
            position: absolute;
            font-size: 12px;
            top: 2px;
            right: 3px;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
            /* keep modal usable on small screens */
            max-height: 80vh;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .color-picker-section {
            margin: 20px 0;
        }

        .color-picker-section label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .color-option {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #333;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }

        .custom-color-input {
            width: 100%;
            height: 50px;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 10px;
        }

        .comment-section {
            margin: 20px 0;
        }

        .comment-section label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .comment-section textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        .sync-comment-label {
            display: flex;
            align-items: center;
            margin-top: 10px;
            cursor: pointer;
            color: #333;
            font-size: 0.95em;
        }

        .sync-comment-label input[type="checkbox"] {
            margin-right: 8px;
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .sync-comment-label:hover {
            color: #667eea;
        }

        /* PDF settings panel */
        #pdfSettingsPanel input[type="text"] {
            font-family: inherit;
            font-size: 0.95em;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }

        /* Keep action buttons visible when modal content scrolls */
        .modal-content .button-group {
            position: sticky;
            bottom: 0;
            background: white;
            padding-top: 12px;
            margin-top: 12px;
            z-index: 10;
        }

        button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-cancel {
            background: #e0e0e0;
            color: #333;
        }

        .btn-cancel:hover {
            background: #d0d0d0;
        }

        .btn-delete {
            background: #ff6b6b;
            color: white;
        }

        .btn-delete:hover {
            background: #ff5252;
        }

        /* Holiday List */
        .holiday-list-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .holiday-list-section h2 {
            font-size: 1.5em;
            margin-bottom: 20px;
            color: #333;
        }

        .holiday-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            background: #f9f9f9;
            border-left: 5px solid;
            gap: 15px;
        }

        .holiday-color {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            flex-shrink: 0;
        }

        .holiday-info {
            flex-grow: 1;
        }

        .holiday-date {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
        }

        .holiday-comment {
            font-size: 0.95em;
            color: #666;
            margin-top: 5px;
        }

        .holiday-actions {
            display: flex;
            gap: 10px;
        }

        .btn-edit, .btn-remove {
            padding: 8px 12px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .btn-edit {
            background: #667eea;
            color: white;
        }

        .btn-edit:hover {
            background: #5469d8;
        }

        .btn-remove {
            background: #ff6b6b;
            color: white;
        }

        .btn-remove:hover {
            background: #ff5252;
        }

        .empty-message {
            text-align: center;
            color: #999;
            padding: 30px;
            font-size: 1.1em;
        }

        .close-btn {
            float: right;
            font-size: 28px;
            font-weight: bold;
            color: #aaa;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .close-btn:hover {
            color: #000;
        }

        .btn-export {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .btn-export:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <div style="display: flex; justify-content: space-between; align-items: center; gap: 12px; margin-bottom: 12px;">
            <div style="display:flex; align-items:center; gap:12px;">
                <h1 style="margin: 0;">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</h1>
                <div style="display:flex; align-items:center; gap:6px;">
                    <button class="btn-cancel" style="padding:6px 8px;" onclick="changeYear(-1)">‚óÄ</button>
                    <input id="yearInput" type="number" style="width:90px; padding:6px; border-radius:6px; border:1px solid #ddd; text-align:center;" />
                    <button class="btn-cancel" style="padding:6px 8px;" onclick="changeYear(1)">‚ñ∂</button>
                </div>
            </div>
            <div style="display:flex; gap:8px; align-items:center;">
                <button class="btn-export" onclick="exportToPDF()">üì• ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å PDF</button>
                <button class="btn-cancel" id="toggleSettingsBtn" onclick="toggleSettings()">‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
            </div>
        </div>

        <div id="pdfSettingsPanel" style="display:none; background: #fff; padding:12px; border-radius:8px; margin-bottom:12px; box-shadow: 0 6px 18px rgba(0,0,0,0.08);">
            <div style="display:flex; gap:12px; flex-wrap:wrap;">
                <div style="flex:1; min-width:260px;">
                    <label style="font-weight:700; display:block; margin-bottom:6px;">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 1</label>
                    <input id="pdfHeader1" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;" />
                </div>
                <div style="flex:1; min-width:260px;">
                    <label style="font-weight:700; display:block; margin-bottom:6px;">‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ó‡∏µ‡πà 2</label>
                    <input id="pdfHeader2" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;" />
                </div>
            </div>
            <div style="margin-top:10px; display:grid; grid-template-columns:repeat(3,1fr); gap:10px;">
                <div>
                    <label style="font-weight:700; display:block; margin-bottom:6px;">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô 1 - ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input id="sig1Title" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;" />
                    <label style="font-weight:700; display:block; margin-top:6px; margin-bottom:6px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°</label>
                    <input id="sig1Name" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;" />
                </div>
                <div>
                    <label style="font-weight:700; display:block; margin-bottom:6px;">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô 2 - ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input id="sig2Title" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;" />
                    <label style="font-weight:700; display:block; margin-top:6px; margin-bottom:6px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°</label>
                    <input id="sig2Name" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;" />
                </div>
                <div>
                    <label style="font-weight:700; display:block; margin-bottom:6px;">‡∏•‡∏≤‡∏¢‡πÄ‡∏ã‡πá‡∏ô 3 - ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label>
                    <input id="sig3Title" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;" />
                    <label style="font-weight:700; display:block; margin-top:6px; margin-bottom:6px;">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏•‡∏á‡∏ô‡∏≤‡∏°</label>
                    <input id="sig3Name" type="text" style="width:100%; padding:8px; border:1px solid #ddd; border-radius:6px;" />
                </div>
            </div>
            <div style="margin-top:12px; text-align:right;">
                <button class="btn-save" onclick="savePDFSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
            </div>
        </div>

        <div class="calendar-grid" id="calendarGrid"></div>

        <div class="holiday-list-section">
            <h2>üéâ ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</h2>
            <div id="holidayList"></div>
        </div>
    </div>

    <!-- Modal -->
    <div id="holidayModal" class="modal">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal()">&times;</span>
            <div class="modal-header">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</div>

            <div class="color-picker-section">
                <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ:</label>
                <div class="color-palette" id="colorPalette"></div>
                <label style="display: block; margin-top: 15px;">‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ:</label>
                <input type="color" id="customColor" class="custom-color-input">
            </div>

            <div class="comment-section">
                <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡∏ß‡πà‡∏≤‡∏™‡∏µ‡∏ô‡∏µ‡πâ‡∏Ñ‡∏∑‡∏≠‡∏≠‡∏∞‡πÑ‡∏£):</label>
                <textarea id="commentInput" placeholder="‡πÄ‡∏ä‡πà‡∏ô: ‡∏™‡∏µ‡πÅ‡∏î‡∏á = ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç, ‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô = ‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô"></textarea>
                
                <label class="sync-comment-label">
                    <input type="checkbox" id="syncCommentCheckbox" checked>
                    <span>‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏°‡πÄ‡∏°‡πâ‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏µ‡∏ô‡∏µ‡πâ</span>
                </label>
            </div>

            <div class="button-group">
                <button class="btn-cancel" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn-delete" id="deleteBtn" style="display: none;" onclick="deleteHoliday()">‡∏•‡∏ö</button>
                <button class="btn-save" onclick="saveHoliday()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>

    <script>
        const colors = [
            '#FF6B6B', '#FF8E72', '#FFA94D', '#FFD93D', '#6BCB77',
            '#4D96FF', '#667eea', '#764ba2', '#F38181', '#AA96DA',
            '#FCBAD3', '#A8D8EA', '#AA96DA', '#FCE77D', '#A8E6CF'
        ];

        let holidays = {}; // Format: 'YYYY-MM-DD': { color, comment }
        let currentDate = null;
        let selectedYear = new Date().getFullYear();

        function initCalendar() {
            const calendarGrid = document.getElementById('calendarGrid');
            calendarGrid.innerHTML = '';

            const year = selectedYear || new Date().getFullYear();

            for (let month = 0; month < 12; month++) {
                const monthCard = createMonthCard(year, month);
                calendarGrid.appendChild(monthCard);
            }

            loadHolidays();
            updateHolidayList();
        }

        function createMonthCard(year, month) {
            const card = document.createElement('div');
            card.className = 'month-card';

            const monthNames = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô',
                '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°',
                '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];

            const header = document.createElement('div');
            header.className = 'month-header';
            header.textContent = `${monthNames[month]} ${year + 543}`;

            const weekdayRow = document.createElement('div');
            weekdayRow.className = 'weekday-row';
            const weekdays = ['‡∏≠', '‡∏à', '‡∏®', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'];
            weekdays.forEach(day => {
                const dayEl = document.createElement('div');
                dayEl.className = 'weekday';
                dayEl.textContent = day;
                weekdayRow.appendChild(dayEl);
            });

            const dayRow = document.createElement('div');
            dayRow.className = 'day-row';

            const firstDay = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();

            // Empty cells
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'day empty';
                dayRow.appendChild(emptyDay);
            }

            // Days
            for (let day = 1; day <= daysInMonth; day++) {
                const dayEl = document.createElement('div');
                dayEl.className = 'day';
                dayEl.textContent = day;

                const dateObj = new Date(year, month, day);
                const dayOfWeek = dateObj.getDay();
                
                if (dayOfWeek === 0) {
                    dayEl.classList.add('sunday');
                }

                const dateString = formatDate(year, month, day);
                if (holidays[dateString]) {
                    dayEl.classList.add('holiday');
                    dayEl.style.background = holidays[dateString].color;
                }

                dayEl.onclick = () => openModal(year, month, day, dateString);
                dayRow.appendChild(dayEl);
            }

            card.appendChild(header);
            card.appendChild(weekdayRow);
            card.appendChild(dayRow);

            return card;
        }

        function formatDate(year, month, day) {
            return `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
        }

        function getCommentForColor(color) {
            // Find any existing holiday with this color and get its comment
            for (const [date, data] of Object.entries(holidays)) {
                if (data.color === color && data.comment) {
                    return data.comment;
                }
            }
            return '';
        }

        function openModal(year, month, day, dateString) {
            currentDate = dateString;
            const modal = document.getElementById('holidayModal');

            // Clear previous selections
            document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
            document.getElementById('commentInput').value = '';
            document.getElementById('deleteBtn').style.display = 'none';
            document.getElementById('customColor').value = '#667eea';
            document.getElementById('syncCommentCheckbox').checked = true;

            // Load existing holiday if exists
            if (holidays[dateString]) {
                document.getElementById('customColor').value = holidays[dateString].color;
                document.getElementById('commentInput').value = holidays[dateString].comment || '';
                document.getElementById('deleteBtn').style.display = 'inline-block';
                document.getElementById('syncCommentCheckbox').checked = false;

                // Find and select matching color
                const selectedColor = document.querySelector(`.color-option[data-color="${holidays[dateString].color}"]`);
                if (selectedColor) {
                    selectedColor.classList.add('selected');
                }
            } else {
                // Check if this color already exists and auto-fill comment
                const existingComment = getCommentForColor(document.getElementById('customColor').value);
                if (existingComment) {
                    document.getElementById('commentInput').value = existingComment;
                    document.getElementById('syncCommentCheckbox').checked = true;
                }
            }

            const monthNames = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô',
                '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°',
                '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];

            document.querySelector('.modal-header').textContent = `${day} ${monthNames[month]} ${year + 543}`;
            modal.style.display = 'block';
        }

        function closeModal() {
            document.getElementById('holidayModal').style.display = 'none';
            currentDate = null;
        }

        function saveHoliday() {
            const color = document.getElementById('customColor').value;
            const comment = document.getElementById('commentInput').value;
            const syncComment = document.getElementById('syncCommentCheckbox').checked;

            if (currentDate) {
                if (syncComment) {
                    // Update all holidays with the same color to have the same comment
                    for (const [date, data] of Object.entries(holidays)) {
                        if (data.color === color) {
                            data.comment = comment;
                        }
                    }
                }
                
                // Save the current holiday
                holidays[currentDate] = { color, comment };
                saveHolidays();
                initCalendar();
                closeModal();
            }
        }

        function deleteHoliday() {
            if (currentDate && holidays[currentDate]) {
                delete holidays[currentDate];
                saveHolidays();
                initCalendar();
                closeModal();
            }
        }

        function saveHolidays() {
            localStorage.setItem('holidays', JSON.stringify(holidays));
        }

        function loadHolidays() {
            const saved = localStorage.getItem('holidays');
            if (saved) {
                holidays = JSON.parse(saved);
            }
        }

        function updateHolidayList() {
            const holidayList = document.getElementById('holidayList');
            const sortedHolidays = Object.entries(holidays).sort((a, b) => new Date(a[0]) - new Date(b[0]));

            if (sortedHolidays.length === 0) {
                holidayList.innerHTML = '<div class="empty-message">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</div>';
                return;
            }

            holidayList.innerHTML = sortedHolidays.map(([date, data]) => {
                const dateObj = new Date(date + 'T00:00:00');
                const monthNames = [
                    '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô',
                    '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°',
                    '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
                ];
                const day = dateObj.getDate();
                const month = monthNames[dateObj.getMonth()];
                const year = dateObj.getFullYear() + 543;
                const dayOfWeek = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'][dateObj.getDay()];

                return `
                    <div class="holiday-item" style="border-left-color: ${data.color}">
                        <div class="holiday-color" style="background: ${data.color}"></div>
                        <div class="holiday-info">
                            <div class="holiday-date">${day} ${month} ${year} (${dayOfWeek})</div>
                            ${data.comment ? `<div class="holiday-comment">üí¨ ${data.comment}</div>` : ''}
                        </div>
                        <div class="holiday-actions">
                            <button class="btn-edit" onclick="editHoliday('${date}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                            <button class="btn-remove" onclick="removeHoliday('${date}')">‡∏•‡∏ö</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function editHoliday(date) {
            const [year, month, day] = date.split('-');
            openModal(parseInt(year), parseInt(month) - 1, parseInt(day), date);
        }

        function removeHoliday(date) {
            if (confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) {
                delete holidays[date];
                saveHolidays();
                initCalendar();
                updateHolidayList();
            }
        }

        function initColorPalette() {
            const palette = document.getElementById('colorPalette');
            palette.innerHTML = colors.map(color => `
                <div class="color-option" data-color="${color}" style="background: ${color}" 
                     onclick="selectColor('${color}')"></div>
            `).join('');
        }

        function selectColor(color) {
            document.getElementById('customColor').value = color;
            document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
            event.target.classList.add('selected');
            
            // Auto-fill comment based on color
            const existingComment = getCommentForColor(color);
            if (existingComment) {
                document.getElementById('commentInput').value = existingComment;
                document.getElementById('syncCommentCheckbox').checked = true;
            } else {
                document.getElementById('syncCommentCheckbox').checked = true;
            }
        }

        // Update custom color input handler
        document.addEventListener('DOMContentLoaded', function() {
            const customColorInput = document.getElementById('customColor');
            if (customColorInput) {
                customColorInput.addEventListener('change', function() {
                    // Clear color palette selection
                    document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
                    
                    // Auto-fill comment based on color
                    const existingComment = getCommentForColor(this.value);
                    if (existingComment) {
                        document.getElementById('commentInput').value = existingComment;
                        document.getElementById('syncCommentCheckbox').checked = true;
                    } else {
                        document.getElementById('syncCommentCheckbox').checked = true;
                    }
                });
            }
        });

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('holidayModal');
            if (event.target == modal) {
                closeModal();
            }
        }

        // PDF settings storage
        const defaultPDFSettings = {
            header1: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2569 ‡πÅ‡∏ú‡∏ô‡∏Å Maintenance',
            header2: '‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏≤ ‡∏•‡∏¥‡∏°‡∏õ‡πå‡∏ó‡∏≠‡∏á‡∏ó‡∏¥‡∏û‡∏¢‡πå  ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô S684168  ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Engineer',
            signatures: [
                { title: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ÅMT', name: '' },
                { title: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•', name: '' },
                { title: '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö', name: '' }
            ]
        };

        function loadPDFSettings() {
            const raw = localStorage.getItem('pdfSettings');
            let settings;
            try {
                settings = raw ? JSON.parse(raw) : defaultPDFSettings;
            } catch (e) {
                settings = defaultPDFSettings;
            }

            // Ensure structure
            settings = Object.assign({}, defaultPDFSettings, settings);
            settings.signatures = settings.signatures && settings.signatures.length === 3 ? settings.signatures : defaultPDFSettings.signatures;

            // Populate inputs
            const h1 = document.getElementById('pdfHeader1');
            const h2 = document.getElementById('pdfHeader2');
            if (h1) h1.value = settings.header1;
            if (h2) h2.value = settings.header2;

            const s1t = document.getElementById('sig1Title');
            const s2t = document.getElementById('sig2Title');
            const s3t = document.getElementById('sig3Title');
            const s1n = document.getElementById('sig1Name');
            const s2n = document.getElementById('sig2Name');
            const s3n = document.getElementById('sig3Name');
            if (s1t) s1t.value = settings.signatures[0].title;
            if (s2t) s2t.value = settings.signatures[1].title;
            if (s3t) s3t.value = settings.signatures[2].title;
            if (s1n) s1n.value = settings.signatures[0].name;
            if (s2n) s2n.value = settings.signatures[1].name;
            if (s3n) s3n.value = settings.signatures[2].name;

            return settings;
        }

        function savePDFSettings() {
            const settings = {
                header1: document.getElementById('pdfHeader1').value || defaultPDFSettings.header1,
                header2: document.getElementById('pdfHeader2').value || defaultPDFSettings.header2,
                signatures: [
                    { title: document.getElementById('sig1Title').value || defaultPDFSettings.signatures[0].title, name: document.getElementById('sig1Name').value || '' },
                    { title: document.getElementById('sig2Title').value || defaultPDFSettings.signatures[1].title, name: document.getElementById('sig2Name').value || '' },
                    { title: document.getElementById('sig3Title').value || defaultPDFSettings.signatures[2].title, name: document.getElementById('sig3Name').value || '' }
                ]
            };
            localStorage.setItem('pdfSettings', JSON.stringify(settings));
            document.getElementById('pdfSettingsPanel').style.display = 'none';
            alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
        }

        function toggleSettings() {
            const panel = document.getElementById('pdfSettingsPanel');
            if (!panel) return;
            panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
        }

        // Year selection functions
        function loadSelectedYear() {
            const raw = localStorage.getItem('selectedYear');
            selectedYear = raw ? parseInt(raw, 10) : new Date().getFullYear();
            const el = document.getElementById('yearInput');
            if (el) {
                el.value = selectedYear;
                el.addEventListener('change', function(e) {
                    const v = parseInt(e.target.value, 10);
                    if (!isNaN(v)) {
                        selectedYear = v;
                        localStorage.setItem('selectedYear', String(selectedYear));
                        initCalendar();
                    }
                });
            }
        }

        function saveSelectedYear() {
            localStorage.setItem('selectedYear', String(selectedYear));
        }

        function changeYear(delta) {
            selectedYear = (selectedYear || new Date().getFullYear()) + delta;
            const el = document.getElementById('yearInput');
            if (el) el.value = selectedYear;
            saveSelectedYear();
            initCalendar();
        }

        // Initialize
        initColorPalette();
        loadPDFSettings();
        loadSelectedYear();
        initCalendar();
    </script>

    <!-- Export to PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        async function exportToPDF() {
            // Create a new element for PDF content
            const element = document.createElement('div');
            element.style.padding = '20px';
            element.style.backgroundColor = 'white';

            // Add report header (two lines) above calendar title using stored settings
            const reportHeader = document.createElement('div');
            reportHeader.style.textAlign = 'center';
            reportHeader.style.marginBottom = '6px';

            const stored = (function(){ try { return JSON.parse(localStorage.getItem('pdfSettings') || 'null'); } catch(e) { return null; } })() || {
                header1: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ß‡∏±‡∏ô‡πÄ‡∏™‡∏≤‡∏£‡πå ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ 2569 ‡πÅ‡∏ú‡∏ô‡∏Å Maintenance',
                header2: '‡∏ô‡∏≤‡∏¢‡∏à‡∏¥‡∏£‡∏≤ ‡∏•‡∏¥‡∏°‡∏õ‡πå‡∏ó‡∏≠‡∏á‡∏ó‡∏¥‡∏û‡∏¢‡πå  ‡∏£‡∏´‡∏±‡∏™‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô S684168  ‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á Engineer'
            };

            const headerLine1 = document.createElement('div');
            headerLine1.textContent = stored.header1;
            headerLine1.style.fontWeight = '700';
            headerLine1.style.fontSize = '14px';
            headerLine1.style.marginBottom = '4px';
            reportHeader.appendChild(headerLine1);

            const headerLine2 = document.createElement('div');
            headerLine2.textContent = stored.header2;
            headerLine2.style.fontSize = '11px';
            reportHeader.appendChild(headerLine2);

            element.appendChild(reportHeader);

            // Add title
            const title = document.createElement('h1');
            title.textContent = '‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î';
            title.style.textAlign = 'center';
            title.style.marginBottom = '10px';
            element.appendChild(title);

            // Add current date
            const currentDate = document.createElement('p');
            currentDate.textContent = `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏°‡∏û‡πå: ${new Date().toLocaleDateString('th-TH', { year: 'numeric', month: 'long', day: 'numeric' })}`;
            currentDate.style.textAlign = 'center';
            currentDate.style.marginBottom = '30px';
            currentDate.style.color = '#666';
            element.appendChild(currentDate);

            // Add calendar months
            const monthNames = [
                '‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°', '‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå', '‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°', '‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô',
                '‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°', '‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô', '‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°', '‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°',
                '‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô', '‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°', '‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô', '‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'
            ];

            const year = selectedYear || new Date().getFullYear();

            const calendarSection = document.createElement('h2');
            calendarSection.textContent = '‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô';
            calendarSection.style.marginTop = '40px';
            calendarSection.style.marginBottom = '20px';
            element.appendChild(calendarSection);

            // Create calendar grid for PDF (4x3 compact layout)
            const calendarGrid = document.createElement('div');
            calendarGrid.style.display = 'grid';
            calendarGrid.style.gridTemplateColumns = 'repeat(4, 1fr)';
            calendarGrid.style.gap = '8px';

            for (let month = 0; month < 12; month++) {
                const monthContainer = document.createElement('div');
                monthContainer.style.border = '1px solid #ddd';
                monthContainer.style.padding = '4px';
                monthContainer.style.borderRadius = '5px';
                monthContainer.style.pageBreakInside = 'avoid';

                // Month header
                const monthHeader = document.createElement('div');
                monthHeader.textContent = `${monthNames[month]} ${year + 543}`;
                monthHeader.style.backgroundColor = '#667eea';
                monthHeader.style.color = 'white';
                monthHeader.style.padding = '4px';
                monthHeader.style.textAlign = 'center';
                monthHeader.style.fontWeight = 'bold';
                monthHeader.style.marginBottom = '10px';
                monthHeader.style.borderRadius = '3px';
                monthHeader.style.fontSize = '10px';
                monthContainer.appendChild(monthHeader);

                // Create calendar table
                const table = document.createElement('table');
                table.style.width = '100%';
                table.style.borderCollapse = 'collapse';
                table.style.fontSize = '9px';

                // Weekday header
                const headerRow = document.createElement('tr');
                const weekdayLabels = ['‡∏≠', '‡∏à', '‡∏®', '‡∏û', '‡∏û‡∏§', '‡∏®', '‡∏™'];
                weekdayLabels.forEach((day, index) => {
                    const th = document.createElement('th');
                    th.textContent = day;
                    th.style.padding = '3px';
                    th.style.textAlign = 'center';
                    th.style.backgroundColor = '#f0f0f0';
                    th.style.borderBottom = '1px solid #ddd';
                    th.style.fontWeight = 'bold';
                    th.style.fontSize = '9px';
                    if (index === 0) {
                        th.style.color = '#ff0000';
                    }
                    headerRow.appendChild(th);
                });
                table.appendChild(headerRow);

                // Days
                const firstDay = new Date(year, month, 1).getDay();
                // Adjust firstDay to match Sunday = 0
                const daysInMonth = new Date(year, month + 1, 0).getDate();

                let dayCounter = 1;
                for (let week = 0; week < 6; week++) {
                    const row = document.createElement('tr');
                    for (let dayOfWeek = 0; dayOfWeek < 7; dayOfWeek++) {
                        const cell = document.createElement('td');
                        cell.style.padding = '2px';
                        cell.style.textAlign = 'center';
                        cell.style.borderBottom = '1px solid #eee';
                        cell.style.height = '18px';
                        cell.style.fontSize = '8px';

                        if ((week === 0 && dayOfWeek < firstDay) || dayCounter > daysInMonth) {
                            cell.style.backgroundColor = '#fafafa';
                        } else {
                            const dateString = formatDate(year, month, dayCounter);
                            cell.textContent = dayCounter;

                            if (dayOfWeek === 0) {
                                cell.style.backgroundColor = '#ffcccc';
                                cell.style.color = '#ff0000';
                                cell.style.fontWeight = 'bold';
                            }

                            if (holidays[dateString]) {
                                cell.style.backgroundColor = holidays[dateString].color;
                                cell.style.color = 'white';
                                cell.style.fontWeight = 'bold';
                            }

                            dayCounter++;
                        }
                        row.appendChild(cell);
                    }
                    table.appendChild(row);
                    if (dayCounter > daysInMonth) break;
                }

                monthContainer.appendChild(table);
                calendarGrid.appendChild(monthContainer);
            }

            element.appendChild(calendarGrid);

            // Signature section for PDF (placed after calendar on page 1)
            const sigContainer = document.createElement('div');
            sigContainer.style.marginTop = '18px';
            sigContainer.style.display = 'flex';
            sigContainer.style.justifyContent = 'space-between';
            sigContainer.style.gap = '10px';

            const storedSigs = stored && stored.signatures && stored.signatures.length === 3 ? stored.signatures : [
                { title: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏ÅMT', name: '' },
                { title: '‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏ú‡∏ô‡∏Å‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•', name: '' },
                { title: '‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡∏ó‡∏£‡∏≤‡∏ö', name: '' }
            ];

            storedSigs.forEach(s => {
                const box = document.createElement('div');
                box.style.flex = '1';
                box.style.borderTop = '1px solid #333';
                box.style.paddingTop = '8px';
                box.style.textAlign = 'center';
                box.style.fontSize = '11px';

                const title = document.createElement('div');
                title.textContent = s.title;
                title.style.marginBottom = '18px';
                title.style.fontWeight = '600';
                box.appendChild(title);

                const nameLine = document.createElement('div');
                nameLine.textContent = s.name && s.name.trim() ? `‡∏ä‡∏∑‡πà‡∏≠: ${s.name}` : '‡∏ä‡∏∑‡πà‡∏≠: ____________________________';
                nameLine.style.marginBottom = '6px';
                box.appendChild(nameLine);

                const positionLine = document.createElement('div');
                positionLine.textContent = s.title && s.title.trim() ? `‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ${s.title}` : '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á: ________________________';
                positionLine.style.marginBottom = '6px';
                box.appendChild(positionLine);

                const dateLine = document.createElement('div');
                dateLine.textContent = '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ____/____/________';
                box.appendChild(dateLine);

                sigContainer.appendChild(box);
            });

            element.appendChild(sigContainer);

            // Force page break so holiday list appears on page 2
            const pageBreak = document.createElement('div');
            pageBreak.style.pageBreakAfter = 'always';
            pageBreak.style.breakAfter = 'page';
            element.appendChild(pageBreak);

            // Add holiday list (starts on page 2)
            const holidaySection = document.createElement('h2');
            holidaySection.textContent = '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
            holidaySection.style.marginTop = '10px';
            holidaySection.style.marginBottom = '12px';
            element.appendChild(holidaySection);

            // Sort holidays by date
            const sortedHolidays = Object.entries(holidays).sort((a, b) => new Date(a[0]) - new Date(b[0]));

            if (sortedHolidays.length === 0) {
                const emptyMsg = document.createElement('p');
                emptyMsg.textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å';
                emptyMsg.style.color = '#999';
                element.appendChild(emptyMsg);
            } else {
                // Compact two-column holiday list to fit page
                const listContainer = document.createElement('div');
                listContainer.style.columnCount = 2;
                listContainer.style.columnGap = '16px';
                listContainer.style.fontSize = '9px';
                listContainer.style.lineHeight = '1.1';
                listContainer.style.marginTop = '6px';

                sortedHolidays.forEach(([date, data]) => {
                    const dateObj = new Date(date + 'T00:00:00');
                    const day = dateObj.getDate();
                    const month = monthNames[dateObj.getMonth()];
                    const yearBE = dateObj.getFullYear() + 543;
                    const dayOfWeek = ['‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå', '‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå', '‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£', '‡∏û‡∏∏‡∏ò', '‡∏û‡∏§‡∏´‡∏±‡∏™', '‡∏®‡∏∏‡∏Å‡∏£‡πå', '‡πÄ‡∏™‡∏≤‡∏£‡πå'][dateObj.getDay()];

                    const item = document.createElement('div');
                    item.style.display = 'flex';
                    item.style.gap = '8px';
                    item.style.marginBottom = '6px';
                    item.style.breakInside = 'avoid';

                    const colorBox = document.createElement('div');
                    colorBox.style.width = '12px';
                    colorBox.style.height = '12px';
                    colorBox.style.backgroundColor = data.color;
                    colorBox.style.border = '1px solid #ddd';
                    colorBox.style.borderRadius = '2px';
                    colorBox.style.flex = '0 0 auto';

                    const info = document.createElement('div');
                    info.style.flex = '1';

                    const titleLine = document.createElement('div');
                    titleLine.textContent = `${day} ${month} ${yearBE} (${dayOfWeek})`;
                    titleLine.style.fontWeight = '700';
                    titleLine.style.fontSize = '9px';

                    const commentLine = document.createElement('div');
                    commentLine.textContent = data.comment || '-';
                    commentLine.style.color = '#444';
                    commentLine.style.fontSize = '8px';

                    info.appendChild(titleLine);
                    info.appendChild(commentLine);

                    item.appendChild(colorBox);
                    item.appendChild(info);

                    listContainer.appendChild(item);
                });

                element.appendChild(listContainer);
            }

                

                // PDF options
                const opt = {
                    margin: 10,
                    filename: `‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î_${new Date().getTime()}.pdf`,
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2, useCORS: true },
                    jsPDF: { orientation: 'portrait', unit: 'mm', format: 'a4' },
                    pagebreak: { mode: ['css', 'legacy'] }
                };

            // Generate PDF
            html2pdf().set(opt).from(element).save();
        }
    </script>
</body>
</html>
